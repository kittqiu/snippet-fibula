"use strict";function noticeTaskChanged(e){for(var t=0;t<listeners.length;t++)listeners[t].onTaskChanged(e)}var listeners=[],ManageTaskList=React.createClass({displayName:"ManageTaskList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged}),document.getElementById("modal_task_"+e.id))},onTaskChanged:function(e){for(var t=this.state.tasks,a=null,n=0;n<t.length;n++)if(t[n].id===e.id){a=n;break}null!==a?"doing"!==e.status&&(t.splice(a,1),this.setState({tasks:t}),console.log("ExecutingTaskList delete")):"doing"===e.status&&(t.push(e),this.setState({tasks:t}),console.log("ExecutingTaskList add"))},loadTasks:function(){getJSON("/api/project/t/listManage",{uid:this.props.uid},function(e,t){e?fatal(e):this.setState({tasks:t})}.bind(this))},getInitialState:function(){return{tasks:[]}},componentWillMount:function(){this.loadTasks()},render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h2",null,React.createElement("b",null,"管理的任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement("table",{className:"uk-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-2-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务执行人"),React.createElement("th",{className:"uk-width-1-10"},"计划开始时间"),React.createElement("th",{className:"uk-width-1-10"},"计划结束时间"),React.createElement("th",{className:"uk-width-1-10"},"实际开始时间"),React.createElement("th",{className:"uk-width-1-10"},"当前进度"),React.createElement("th",{className:"uk-width-1-10"},"已用工期"),React.createElement("th",{className:"uk-width-1-10"},"计划工期"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a=React.createElement("span",{className:"uk-badge uk-badge-danger uk-badge-notification"},"紧急");return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),getDateTimeAt0(e.plan_end_time)<Date.now()?a:"",React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,e.executor_name),React.createElement("td",null,formatDate(e.plan_start_time)),React.createElement("td",null,formatDate(e.plan_end_time)),React.createElement("td",null,0===e.start_time?"无":formatDate(e.start_time)),React.createElement("td",null,e.percent,"%"),React.createElement("td",null,e.duration,"小时"),React.createElement("td",null,e.plan_duration,"小时"),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))))}}),ExecutingTaskList=React.createClass({displayName:"ExecutingTaskList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged}),document.getElementById("modal_task_"+e.id))},onTaskChanged:function(e){for(var t=this.state.tasks,a=null,n=0;n<t.length;n++)if(t[n].id===e.id){a=n;break}null!==a?"doing"!==e.status&&"commit"!==e.status&&(t.splice(a,1),this.setState({tasks:t}),console.log("ExecutingTaskList delete")):"doing"===e.status&&(t.push(e),this.setState({tasks:t}),console.log("ExecutingTaskList add"))},loadTasks:function(){getJSON("/api/project/t/listExecuting",{uid:this.props.uid},function(e,t){e?fatal(e):this.setState({tasks:t})}.bind(this))},getInitialState:function(){return{tasks:[]}},componentWillMount:function(){this.loadTasks(),listeners.push(this)},render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h2",null,React.createElement("b",null,"今日任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement("table",{className:"uk-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-2-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务状态"),React.createElement("th",{className:"uk-width-1-10"},"计划开始时间"),React.createElement("th",{className:"uk-width-1-10"},"计划结束时间"),React.createElement("th",{className:"uk-width-1-10"},"当前进度"),React.createElement("th",{className:"uk-width-1-10"},"任务审核人"),React.createElement("th",{className:"uk-width-1-10"},"计划工期"),React.createElement("th",{className:"uk-width-1-10"},"已用工期"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,taskStatusMap[e.status]),React.createElement("td",null,formatDate(e.plan_start_time)),React.createElement("td",null,formatDate(e.plan_end_time)),React.createElement("td",null,e.percent,"%"),React.createElement("td",null,e.manager_name),React.createElement("td",null,e.plan_duration,"小时"),React.createElement("td",null,e.duration,"小时"),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))))}}),QueueTaskList=React.createClass({displayName:"QueueTaskList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged}),document.getElementById("modal_task_"+e.id))},onTaskChanged:function(e){for(var t=this.state.tasks,a=null,n=0;n<t.length;n++)if(t[n].id===e.id){a=n;break}null!==a&&"created"!==e.status&&(t.splice(a,1),this.setState({tasks:t}),console.log("ExecutingTaskList delete"))},loadTasks:function(){getJSON("/api/project/t/listQueue",{uid:this.props.uid},function(e,t){e?fatal(e):this.setState({tasks:t})}.bind(this))},getInitialState:function(){return{tasks:[]}},componentWillMount:function(){this.loadTasks(),listeners.push(this)},render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h2",null,React.createElement("b",null,"待执行的任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement("table",{className:"uk-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-3-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"计划开始时间"),React.createElement("th",{className:"uk-width-1-10"},"计划结束时间"),React.createElement("th",{className:"uk-width-1-10"},"任务审核人"),React.createElement("th",{className:"uk-width-1-10"},"工期(小时)"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a=React.createElement("span",{className:"uk-badge uk-badge-danger uk-badge-notification"},"紧急");return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),getDateTimeAt0(e.plan_start_time)<Date.now()?a:"",React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,formatDate(e.plan_start_time)),React.createElement("td",null,formatDate(e.plan_end_time)),React.createElement("td",null,e.manager_name),React.createElement("td",null,e.plan_duration),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))))}}),MyTask=React.createClass({displayName:"MyTask",render:function(){var e={marginTop:"50px"};return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h1",{className:"uk-text-center"},React.createElement("b",null,"我的任务")),React.createElement(ExecutingTaskList,{uid:this.props.uid}),React.createElement("div",{style:e}),React.createElement(ManageTaskList,{uid:this.props.uid}),React.createElement("div",{style:e}),React.createElement(QueueTaskList,{uid:this.props.uid}))}});