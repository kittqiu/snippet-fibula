"use strict";function noticeTaskChanged(e){for(var t=0;t<listeners.length;t++)listeners[t].onTaskChanged(e)}var listeners=[],ManageTaskList=React.createClass({displayName:"ManageTaskList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged,role:"manager"}),document.getElementById("modal_task_"+e.id))},onTaskChanged:function(e){this.setState({updatedCnt:this.state.updatedCnt+1})},sortTasks:function(e){var t=["created","clear","pending","doing","commit"];return e.sort(function(e,a){return e.status===a.status?e.plan_start_time-a.plan_start_time:t.indexOf(a.status)-t.indexOf(e.status)}.bind(this)),e},loadTasks:function(){getJSON("/api/project/t/listManage",{uid:this.props.uid},function(e,t){if(e)fatal(e);else{var a=this.sortTasks(t);this.setState({tasks:a})}}.bind(this))},getInitialState:function(){return{tasks:[],updatedCnt:0}},componentWillMount:function(){this.loadTasks(),listeners.push(this)},render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("table",{className:"uk-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-2-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务状态"),React.createElement("th",{className:"uk-width-1-10"},"任务执行人"),React.createElement("th",{className:"uk-width-1-10"},"计划开始时间"),React.createElement("th",{className:"uk-width-1-10"},"计划结束时间"),React.createElement("th",{className:"uk-width-1-10"},"当前进度"),React.createElement("th",{className:"uk-width-1-10"},"已用工期"),React.createElement("th",{className:"uk-width-1-10"},"计划工期"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a=React.createElement("span",{className:"uk-badge uk-badge-danger uk-badge-notification"},"紧急"),n={created:"uk-text-warning",clear:"",doing:"uk-text-primary",commit:"uk-text-success",completed:"uk-text-success",pending:"uk-text-warning"};return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),getDateTimeAt0(e.plan_end_time)<Date.now()?a:"",React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,React.createElement("span",{className:n[e.status]},taskStatusMap[e.status])),React.createElement("td",null,e.executor_name),React.createElement("td",null,formatDate(e.plan_start_time)),React.createElement("td",null,formatDate(e.plan_end_time)),React.createElement("td",null,e.percent,"%"),React.createElement("td",null,e.duration,"小时"),React.createElement("td",null,e.plan_duration,"小时"),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))))}}),ExecutingTaskList=React.createClass({displayName:"ExecutingTaskList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged,role:"executor"}),document.getElementById("modal_task_"+e.id))},onTaskChanged:function(e){for(var t=this.state.tasks,a=null,n=0;n<t.length;n++)if(t[n].id===e.id){a=n;break}if(null===a||"completed"!==e.status&&"pending"!==e.status&&"cancel"!==e.status)this.loadTasks();else{var s="modal_task_"+e.id,c=new UIkit.modal("#"+s);c.on({"hide.uk.modal":function(e){this.loadTasks()}.bind(this)}),c.hide()}},sortTasks:function(e){var t=["pending","doing","commit"];return e.sort(function(e,a){return e.status===a.status?e.plan_end_time-a.plan_end_time:t.indexOf(a.status)-t.indexOf(e.status)}.bind(this)),e},loadTasks:function(){getJSON("/api/project/t/listExecuting",{uid:this.props.uid},function(e,t){if(e)fatal(e);else{var a=this.sortTasks(t);this.setState({tasks:a})}}.bind(this))},getInitialState:function(){return{tasks:[]}},componentWillMount:function(){this.loadTasks()},render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("table",{className:"uk-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-2-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务状态"),React.createElement("th",{className:"uk-width-1-10"},"计划开始时间"),React.createElement("th",{className:"uk-width-1-10"},"计划结束时间"),React.createElement("th",{className:"uk-width-1-10"},"当前进度"),React.createElement("th",{className:"uk-width-1-10"},"任务审核人"),React.createElement("th",{className:"uk-width-1-10"},"计划工期"),React.createElement("th",{className:"uk-width-1-10"},"已用工期"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a=React.createElement("span",{className:"uk-badge uk-badge-danger uk-badge-notification"},"紧急"),n={doing:"uk-text-primary",commit:"uk-text-success",pending:""};return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),getDateTimeAt0(e.plan_end_time)<Date.now()?a:"",React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,React.createElement("span",{className:n[e.status]},taskStatusMap[e.status])),React.createElement("td",null,formatDate(e.plan_start_time)),React.createElement("td",null,formatDate(e.plan_end_time)),React.createElement("td",null,e.percent,"%"),React.createElement("td",null,e.manager_name),React.createElement("td",null,e.plan_duration,"小时"),React.createElement("td",null,e.duration,"小时"),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))))}}),QueueTaskList=React.createClass({displayName:"QueueTaskList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged,role:"executor"}),document.getElementById("modal_task_"+e.id))},onTaskChanged:function(e){for(var t=this.state.tasks,a=null,n=0;n<t.length;n++)if(t[n].id===e.id){a=n;break}if(null!==a){var s=t[a];if("clear"!==s.status&&"pending"!==s.status||"doing"!==e.status)this.loadTasks();else{var c="modal_task_"+e.id,l=new UIkit.modal("#"+c);l.on({"hide.uk.modal":function(e){this.loadTasks()}.bind(this)}),l.hide()}}else this.loadTasks()},sortTasks:function(e){var t=["created","pending","clear","doing"];return e.sort(function(e,a){return e.status===a.status?e.plan_start_time-a.plan_start_time:t.indexOf(a.status)-t.indexOf(e.status)}.bind(this)),e},loadTasks:function(){getJSON("/api/project/t/listQueue",{uid:this.props.uid},function(e,t){if(e)fatal(e);else{var a=this.sortTasks(t);this.setState({tasks:a})}}.bind(this))},getInitialState:function(){return{tasks:[]}},componentWillMount:function(){this.loadTasks()},render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("hr",{className:"dv-hr"}),React.createElement("table",{className:"uk-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-3-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务状态"),React.createElement("th",{className:"uk-width-1-10"},"计划开始时间"),React.createElement("th",{className:"uk-width-1-10"},"计划结束时间"),React.createElement("th",{className:"uk-width-1-10"},"任务审核人"),React.createElement("th",{className:"uk-width-1-10"},"工期(小时)"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a=React.createElement("span",{className:"uk-badge uk-badge-danger uk-badge-notification"},"紧急"),n={created:"",clear:"uk-text-warning",doing:"uk-text-primary",pending:""};return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),getDateTimeAt0(e.plan_start_time)<Date.now()?a:"",React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,React.createElement("span",{className:n[e.status]},taskStatusMap[e.status])),React.createElement("td",null,formatDate(e.plan_start_time)),React.createElement("td",null,formatDate(e.plan_end_time)),React.createElement("td",null,e.manager_name),React.createElement("td",null,e.plan_duration),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))))}}),MyTask=React.createClass({displayName:"MyTask",render:function(){var e={marginTop:"50px"};return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h1",{className:"uk-text-center"},React.createElement("b",null,"我的任务")),React.createElement("div",{className:"uk-text-right"},React.createElement("a",{href:"/project/task/history",className:"dv-link"},"已结束的历史任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement(ExecutingTaskList,{uid:this.props.uid}),React.createElement("div",{style:e}))}}),MyManageTask=React.createClass({displayName:"MyManageTask",render:function(){var e={marginTop:"50px"};return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h1",{className:"uk-text-center"},React.createElement("b",null,"我管理的任务")),React.createElement("div",{className:"uk-text-right"},React.createElement("a",{href:"/project/task/manage/history",className:"dv-link"},"已结束的历史任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement(ManageTaskList,{uid:this.props.uid}),React.createElement("div",{style:e}))}}),MyPlanTask=React.createClass({displayName:"MyPlanTask",render:function(){var e={marginTop:"50px"};return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h1",{className:"uk-text-center"},React.createElement("b",null,"待执行的任务")),React.createElement(QueueTaskList,{uid:this.props.uid}),React.createElement("div",{style:e}))}});