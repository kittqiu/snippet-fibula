"use strict";var styles={smallBottomMargin:{marginBottom:"2px"},toolbar:{marginTop:"20px"},tableBorder:{borderCollapse:"collapse"}},UserTaskDaily=React.createClass({displayName:"UserTaskDaily",handleViewTask:function(e){e.preventDefault();var t=this.props.task;ReactDOM.render(React.createElement(TaskDialog,{task:t,onTaskChanged:this.onTaskChanged,role:"executor"}),document.getElementById("modal_task_"+t.id))},onTaskChanged:function(){},render:function(){var e=this.props.task,t=e.daily,a=t.org_plan||"未填写",s=(t.plan||"未填写",t.report||"未填写"),l={padding:"0",maxWidth:"310px"},i={padding:"0",maxWidth:"230px"},n="未填写"===a?"dv-pre-clear uk-text-muted":"dv-pre-clear",c="未填写"===s?"dv-pre-clear uk-text-muted":"dv-pre-clear",r="未填写"===s?"uk-text-muted":"";return React.createElement("tr",null,React.createElement("td",{className:"dv-border"},React.createElement("a",{onClick:this.handleViewTask,className:"uk-button-link dv-link"},e.name),React.createElement("div",{id:"modal_task_daily_"+e.id,className:"uk-modal"}),React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",{className:"dv-width-7-20"},React.createElement("pre",{className:c,style:l},s)),React.createElement("td",{className:"dv-width-5-20"},React.createElement("pre",{className:n,style:i},a)),React.createElement("td",null,React.createElement("div",null,"项目：",React.createElement("a",{href:"/project/p/"+e.project_id+"/build",className:"dv-link"},e.project_name)),React.createElement("div",null,"审核人：",e.manager_name),t.duration?React.createElement("div",null,"今日用时：",React.createElement("span",{className:r},t.duration+"小时")):null))}}),DepTaskDaily=React.createClass({displayName:"DepTaskDaily",handleViewTask:function(e){e.preventDefault();var t=this.props.task;ReactDOM.render(React.createElement(TaskDialog,{task:t,onTaskChanged:this.onTaskChanged,role:"executor"}),document.getElementById("modal_task_"+t.id))},onTaskChanged:function(){},render:function(){var e=this.props.task,t=e.daily,a=t.org_plan||"未填写",s=(t.plan||"未填写",t.report||"未填写"),l={padding:"0",maxWidth:"310px"},i={padding:"0",maxWidth:"230px"},n="未填写"===a?"dv-pre-clear uk-text-muted":"dv-pre-clear",c="未填写"===s?"dv-pre-clear uk-text-muted":"dv-pre-clear",r="未填写"===s?"uk-text-muted":"";return React.createElement("tr",null,React.createElement("td",null,e.executor_name),React.createElement("td",{className:"dv-border"},React.createElement("a",{onClick:this.handleViewTask,className:"uk-button-link dv-link"},e.name),React.createElement("div",{id:"modal_task_daily_"+e.id,className:"uk-modal"}),React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",{className:"dv-border"},React.createElement("pre",{className:c,style:l},s)),React.createElement("td",{className:"dv-border"},React.createElement("pre",{className:n,style:i},a)),React.createElement("td",null,React.createElement("div",null,"项目：",React.createElement("a",{href:"/project/p/"+e.project_id+"/build",className:"dv-link"},e.project_name)),React.createElement("div",null,"审核人：",e.manager_name),t.duration?React.createElement("div",null,"今日用时：",React.createElement("span",{className:r},t.duration+"小时")):null))}}),DepartmentDaily=React.createClass({displayName:"DepartmentDaily",loadUserDaily:function(e,t,a){var s=e[t];getJSON("/api/project/u/"+s+"/daily",{date:a},function(s,l){if(s)fatal(s);else{var i=this.state.tasks;i=i.concat(l),this.setState({tasks:i}),t<e.length-1&&this.loadUserDaily(e,t+1,a)}}.bind(this))},loadData:function(e,t){this.state.tasks.splice(0,this.state.tasks.length),this.loadUserDaily(e,0,t)},previous:function(){var e=new Date(this.state.dayTime);e.setDate(e.getDate()-1);var t=e.getTime();this.setState({dayTime:t}),this.loadData(this.props.members,t)},next:function(){var e=new Date(this.state.dayTime);e.setDate(e.getDate()+1);var t=e.getTime();this.setState({dayTime:t}),this.loadData(this.props.members,t)},onTimeChanged:function(e){var t=toDateTime(e.target.value);this.setState({dayTime:t}),this.loadData(this.props.members,t)},getInitialState:function(){return{dayTime:Date.now(),tasks:[]}},componentDidMount:function(){var e=UIkit.datepicker(this.refs.time,{weekstart:0,format:"YYYY-MM-DD"});e.on("change",this.onTimeChanged),this.loadData(this.props.members,this.state.dayTime)},componentWillReceiveProps:function(e){e.members!==this.props.members&&this.loadData(e.members,this.state.dayTime)},render:function(){var e={width:"80px"},t=this.props.deps[this.props.depid]||{};return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h2",{className:"uk-text-center"},React.createElement("b",null,t.name,"的日志")),React.createElement("div",{style:styles.toolbar},React.createElement("ul",{className:"uk-pagination",style:styles.smallBottomMargin},React.createElement("li",{className:"uk-pagination-previous"},React.createElement("a",{onClick:this.previous},React.createElement("i",{className:"uk-icon-angle-double-left"}),"前一天")),React.createElement("li",{className:""},React.createElement("input",{type:"text",name:"time",ref:"time",style:e,value:formatDate(this.state.dayTime),onChange:this.onTimeChanged})),React.createElement("li",{className:"uk-pagination-next"},React.createElement("a",{onClick:this.next},"后一天",React.createElement("i",{className:"uk-icon-angle-double-right"}))))),React.createElement("hr",{className:"dv-hr"}),React.createElement("div",{className:"uk-accordion"},React.createElement("table",{className:"uk-width-1-1 uk-table",style:styles.tableBorder},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"dv-width-2-20"},"执行人"),React.createElement("th",{className:"dv-width-4-20"},"任务"),React.createElement("th",{className:"dv-width-6-20"},"当日工作"),React.createElement("th",{className:"dv-width-4-20"},"原计划"),React.createElement("th",{className:"dv-width-4-20"},"任务信息"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){return React.createElement(DepTaskDaily,{key:t,task:e,dayTime:this.state.dayTime})}.bind(this)))),React.createElement("div",{className:this.state.tasks.length>0?"uk-hidden":""},"无执行任务")))}}),UserDaily=React.createClass({displayName:"UserDaily",loadData:function(e,t){getJSON("/api/project/u/"+e+"/daily",{date:t},function(e,t){e?fatal(e):this.setState({tasks:t})}.bind(this))},previous:function(){var e=new Date(this.state.dayTime);e.setDate(e.getDate()-1);var t=e.getTime();this.setState({dayTime:t}),this.loadData(this.props.uid,t)},next:function(){var e=new Date(this.state.dayTime);e.setDate(e.getDate()+1);var t=e.getTime();this.setState({dayTime:t}),this.loadData(this.props.uid,t)},onTimeChanged:function(e){var t=toDateTime(e.target.value);this.setState({dayTime:t}),this.loadData(this.props.uid,t)},getInitialState:function(){return{dayTime:Date.now(),tasks:[]}},componentDidMount:function(){var e=UIkit.datepicker(this.refs.time,{weekstart:0,format:"YYYY-MM-DD"});e.on("change",this.onTimeChanged),this.loadData(this.props.uid,this.state.dayTime)},componentWillReceiveProps:function(e){e.uid!==this.props.uid&&this.loadData(e.uid,this.state.dayTime)},render:function(){var e={width:"80px"},t=this.props.users[this.props.uid]||{};return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h2",{className:"uk-text-center"},React.createElement("b",null,t.name,"的日志")),React.createElement("div",{style:styles.toolbar},React.createElement("ul",{className:"uk-pagination",style:styles.smallBottomMargin},React.createElement("li",{className:"uk-pagination-previous"},React.createElement("a",{onClick:this.previous},React.createElement("i",{className:"uk-icon-angle-double-left"}),"前一天")),React.createElement("li",{className:""},React.createElement("input",{type:"text",name:"time",ref:"time",style:e,value:formatDate(this.state.dayTime),onChange:this.onTimeChanged})),React.createElement("li",{className:"uk-pagination-next"},React.createElement("a",{onClick:this.next},"后一天",React.createElement("i",{className:"uk-icon-angle-double-right"}))))),React.createElement("hr",{className:"dv-hr"}),React.createElement("div",{className:"uk-accordion"},React.createElement("table",{className:"uk-width-1-1 uk-table",style:styles.tableBorder},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"dv-width-4-20"},"任务"),React.createElement("th",{className:"dv-width-7-20"},"当日工作"),React.createElement("th",{className:"dv-width-5-20"},"原计划"),React.createElement("th",{className:"dv-width-4-20"},"任务信息"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){return React.createElement(UserTaskDaily,{key:t,task:e,dayTime:this.state.dayTime})}.bind(this)))),React.createElement("div",{className:this.state.tasks.length>0?"uk-hidden":""},"无执行任务")))}}),TeamDaily=React.createClass({displayName:"TeamDaily",handleSelected:function(e,t,a){"user"===e?this.setState({selectedType:"user",selectedItem:t}):this.setState({selectedType:"department",selectedItem:t,members:a})},updateUserData:function(e){this.setState({UserMap:e})},updateDepData:function(e){this.setState({DepMap:e})},getInitialState:function(){return{selectedType:"user",selectedItem:ENV.user.id,members:[],UserMap:{},DepMap:{}}},render:function(){var e={borderRight:"1px solid #ddd"};return React.createElement("div",{className:"uk-grid"},React.createElement("div",{className:"uk-width-2-10",style:e},React.createElement(StructureTree,{onSelected:this.handleSelected,updateDepData:this.updateDepData,updateUserData:this.updateUserData})),React.createElement("div",{className:"uk-width-8-10"},"user"===this.state.selectedType?React.createElement(UserDaily,{key:"UserDaily_"+this.state.selectedItem,uid:this.state.selectedItem,users:this.state.UserMap}):React.createElement(DepartmentDaily,{key:"DepartmentDaily_"+this.state.selectedItem,depid:this.state.selectedItem,members:this.state.members,deps:this.state.DepMap,users:this.state.UserMap})))}});