"use strict";function noticeTaskChanged(e){for(var t=0;t<listeners.length;t++)listeners[t].onTaskChanged(e)}var listeners=[],ManageHistoryList=React.createClass({displayName:"ManageHistoryList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged,role:"manager"}),document.getElementById("modal_task_"+e.id))},loadTasks:function(){getJSON("/api/project/t/history/listManage",{uid:ENV.user.id,page:this.props.page},function(e,t){e?fatal(e):this.setState({tasks:t.tasks,page:t.page,pagelist:t.page.list})}.bind(this))},getInitialState:function(){return{page:{},pagelist:[],tasks:[]}},componentWillMount:function(){this.loadTasks()},render:function(){var e=this.state.page,t=1==e.index?React.createElement("li",{className:"uk-disabled"},React.createElement("span",null,React.createElement("i",{className:"uk-icon-angle-double-left"}))):React.createElement("li",null,React.createElement("a",{href:"?page="+(e.index-1)+"&uid="+ENV.user.id},React.createElement("i",{className:"uk-icon-angle-double-left"}))),a=e.index==Math.floor(e.total/e.size)+1?React.createElement("li",{className:"uk-disabled"},React.createElement("span",null,React.createElement("i",{className:"uk-icon-angle-double-right"}))):React.createElement("li",null,React.createElement("a",{href:"?page="+(e.index+1)+"&uid="+ENV.user.id},React.createElement("i",{className:"uk-icon-angle-double-right"})));return React.createElement("div",{className:"uk-width-1-1"},React.createElement("table",{className:this.state.tasks.length>0?"uk-table":"uk-hidden"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-2-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务状态"),React.createElement("th",{className:"uk-width-1-10"},"任务执行人"),React.createElement("th",{className:"uk-width-1-10"},"开始时间"),React.createElement("th",{className:"uk-width-1-10"},"结束时间"),React.createElement("th",{className:"uk-width-1-10"},"用时"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a={completed:"",cancel:"uk-text-warning"};return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,React.createElement("span",{className:a[e.status]},taskStatusMap[e.status])),React.createElement("td",null,e.executor_name),React.createElement("td",null,formatDate(e.start_time)),React.createElement("td",null,formatDate(e.end_time)),React.createElement("td",null,e.duration,"小时"),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))),React.createElement("div",{className:this.state.tasks.length>0?"uk-hidden":""},"无记录"),React.createElement("div",{className:this.state.page.pages>1?"uk-text-center":"uk-hidden"},React.createElement("ul",{className:"uk-pagination"},t,this.state.pagelist.map(function(t,a){return"..."===t?React.createElement("li",{key:a,className:"uk-disabled"},React.createElement("span",null,"...")):t==e.index?React.createElement("li",{key:a,className:"uk-active"},React.createElement("span",null,t)):React.createElement("li",{key:a},React.createElement("a",{href:"?page="+t+"&uid="+ENV.user.id},t))}.bind(this)),a)))}}),ExecuteHistoryList=React.createClass({displayName:"ExecuteHistoryList",handleView:function(e,t){t.preventDefault(),ReactDOM.render(React.createElement(TaskDialog,{task:e,onTaskChanged:noticeTaskChanged,role:"executor"}),document.getElementById("modal_task_"+e.id))},loadTasks:function(){getJSON("/api/project/t/history/listCompleted",{uid:ENV.user.id,page:this.props.page},function(e,t){e?fatal(e):this.setState({tasks:t.tasks,page:t.page,pagelist:t.page.list})}.bind(this))},getInitialState:function(){return{page:{},pagelist:[],tasks:[]}},componentWillMount:function(){this.loadTasks()},render:function(){var e=this.state.page,t=1==e.index?React.createElement("li",{className:"uk-disabled"},React.createElement("span",null,React.createElement("i",{className:"uk-icon-angle-double-left"}))):React.createElement("li",null,React.createElement("a",{href:"?page="+(e.index-1)+"&uid="+ENV.user.id},React.createElement("i",{className:"uk-icon-angle-double-left"}))),a=e.index==Math.floor(e.total/e.size)+1?React.createElement("li",{className:"uk-disabled"},React.createElement("span",null,React.createElement("i",{className:"uk-icon-angle-double-right"}))):React.createElement("li",null,React.createElement("a",{href:"?page="+(e.index+1)+"&uid="+ENV.user.id},React.createElement("i",{className:"uk-icon-angle-double-right"})));return React.createElement("div",{className:"uk-width-1-1"},React.createElement("table",{className:this.state.tasks.length>0?"uk-table":"uk-hidden"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"uk-width-2-10"},"任务名称"),React.createElement("th",{className:"uk-width-1-10"},"任务状态"),React.createElement("th",{className:"uk-width-1-10"},"开始时间"),React.createElement("th",{className:"uk-width-1-10"},"结束时间"),React.createElement("th",{className:"uk-width-1-10"},"任务审核人"),React.createElement("th",{className:"uk-width-1-10"},"用时"),React.createElement("th",{className:"uk-width-1-10"},"所属的项目"))),React.createElement("tbody",null,this.state.tasks.map(function(e,t){var a={commit:"",cancel:"uk-text-warning"};return React.createElement("tr",{key:e.id},React.createElement("td",null,React.createElement("a",{className:"dv-link",onClick:this.handleView.bind(this,e)},e.name),React.createElement("div",{id:"modal_task_"+e.id,className:"uk-modal"})),React.createElement("td",null,React.createElement("span",{className:a[e.status]},taskStatusMap[e.status])),React.createElement("td",null,formatDate(e.start_time)),React.createElement("td",null,formatDate(e.end_time)),React.createElement("td",null,e.manager_name),React.createElement("td",null,e.duration,"小时"),React.createElement("td",null,React.createElement("a",{className:"dv-link",href:"/project/p/"+e.project_id+"/build"},e.project_name)))}.bind(this)))),React.createElement("div",{className:this.state.tasks.length>0?"uk-hidden":""},"无记录"),React.createElement("div",{className:this.state.page.pages>1?"uk-text-center":"uk-hidden"},React.createElement("ul",{className:"uk-pagination"},t,this.state.pagelist.map(function(t,a){return"..."===t?React.createElement("li",{key:a,className:"uk-disabled"},React.createElement("span",null,"...")):t==e.index?React.createElement("li",{key:a,className:"uk-active"},React.createElement("span",null,t)):React.createElement("li",{key:a},React.createElement("a",{href:"?page="+t+"&uid="+ENV.user.id},t))}.bind(this)),a)))}}),MyManageHistory=React.createClass({displayName:"MyManageHistory",render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h1",{className:"uk-text-center"},React.createElement("b",null,"历史管理的任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement(ManageHistoryList,{page:this.props.page}))}}),MyExecuteHistory=React.createClass({displayName:"MyExecuteHistory",render:function(){return React.createElement("div",{className:"uk-width-1-1"},React.createElement("h1",{className:"uk-text-center"},React.createElement("b",null,"历史完成的任务")),React.createElement("hr",{className:"dv-hr"}),React.createElement(ExecuteHistoryList,{page:this.props.page}))}});